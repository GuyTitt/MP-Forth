# début du "tests" version "4"
from memoire import mem
from piles import piles
import uasyncio as asyncio

async def assert_eq(a, b, msg):
    if a != b:
        print(f"ÉCHEC: {msg} → {a} ≠ {b}")
    else:
        print(f"OK    : {msg}")

async def run_all_tests():
    print("\n" + "="*60)
    print(" SUITE DE TESTS COMPLÈTE – FORTH ESP32-S3")
    print("="*60)
    
    mem.sp = mem.SP0

    await piles.push(10); await piles.push(20)
    await assert_eq(await piles.pop(), 20, "push/pop")
    await piles.push(5); await piles.push(5)
    x = await piles.pop(); await piles.push(x); await piles.push(x)
    await assert_eq(await piles.pop(), 5, "DUP")

    await piles.push(7); await piles.push(8)
    a = await piles.pop(); b = await piles.pop()
    await piles.push(b + a)
    await assert_eq(await piles.pop(), 15, "+")

    await piles.push(6); await piles.push(7)
    b = await piles.pop(); await piles.push(await piles.pop() - b)
    await assert_eq(await piles.pop(), -1, "-")

    await piles.push(9); await piles.push(8)
    await piles.push(await piles.pop() * await piles.pop())
    await assert_eq(await piles.pop(), 72, "*")

    print("\nTOUS LES TESTS DU VOCABULAIRE DE BASE ONT RÉUSSI !\n")
    print("="*60)

version = ('tests.py', 4)
print(f"tests v{version[1]} chargé")
# fin du "tests" version "4"